{% extends "base.html" %}

{% block content %}
<div class="container py-3" style="max-width: 900px;">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div>
      <h3 class="mb-0">Plans</h3>
      <small class="text-muted">Choose the plan that fits you</small>
    </div>
  </div>

  <div id="plans-messages"></div>

  <div class="row g-3">
    {% for p in plans %}
      {% with code=p.code|lower %}
      <div class="col-md-4">
        <div class="card-soft h-100 p-3 d-flex flex-column">
          <div class="d-flex justify-content-between align-items-start mb-2">
            <h5 class="mb-0">{{ p.name }}</h5>
            {% if current_plan == code %}
              <span class="badge bg-success-subtle text-success">Current</span>
            {% endif %}
          </div>
          <div class="mb-2">
            <div class="fs-4 fw-semibold">{{ p.price_egp }} EGP</div>
            <div class="text-muted small">for {{ p.duration_days }} days</div>
          </div>

          {% if code == "basic" %}
            <ul class="text-muted small mb-3 ps-3">
              <li>Access to <strong>QBank</strong> questions only</li>
              <li>AI daily limit: <strong>10</strong></li>
              <li>Create personal flashcards</li>
              <li>No Exam Review, TBL, Flipped, or Old Exams</li>
              <li>No admin flashcards</li>
            </ul>

          {% elif code == "premium" %}
            <ul class="text-muted small mb-3 ps-3">
              <li>Access to <strong>QBank</strong> and <strong>Exam Review</strong></li>
              <li>AI daily limit: <strong>30</strong></li>
              <li>View admin flashcards + create personal ones</li>
              <li>No TBL, Flipped, or Old Exams</li>
              <li>Full access to lesson content</li>
            </ul>

          {% elif code == "advanced" %}
            <ul class="text-muted small mb-3 ps-3">
              <li>Access to <strong>all question sources</strong>:
                QBank, Exam Review, TBL, Flipped, Old Exams
              </li>
              <li>AI daily limit: <strong>100</strong></li>
              <li>View admin + personal flashcards</li>
              <li>Full lesson content access</li>
              <li>Everything in previous plans included</li>
            </ul>

          {% else %}
            <ul class="text-muted small mb-3 ps-3">
              <li>No question access</li>
              <li>No AI usage</li>
              <li>No flashcards or materials</li>
            </ul>
          {% endif %}

          <div class="mt-auto">
            {% if current_plan == "advanced" %}
              <button class="btn btn-success btn-sm w-100" disabled>
                You're on the highest plan
              </button>
            {% elif current_plan == code %}
              <button class="btn btn-success btn-sm w-100" disabled>
                You're on this plan
              </button>
            {% else %}
              <a href="{% url 'web_payment_page' %}?plan={{ p.code }}" class="btn btn-primary btn-sm w-100">
                Pay via Instapay
              </a>
            {% endif %}
          </div>
        </div>
      </div>
      {% endwith %}
    {% endfor %}
  </div>

  {% if not is_active %}
    <div class="mt-4">
      <form
        hx-post="{% url 'web_plans_start_trial' %}"
        hx-target="#plans-messages"
        hx-swap="innerHTML"
        class="d-inline-block">
        <button class="btn btn-outline-success btn-sm" type="submit">
          <span class="spinner-border spinner-border-sm me-1 htmx-indicator" role="status"></span>
          Start free trial
        </button>
      </form>
    </div>
  {% endif %}
</div>
{% endblock %}
